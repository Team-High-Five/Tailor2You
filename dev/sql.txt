CREATE TABLE `users` (
  `user_id` INT(5) NOT NULL AUTO_INCREMENT,
  `user_type` ENUM('tailor', 'customer', 'shopkeeper') NOT NULL,
  `first_name` VARCHAR(20) NOT NULL,
  `last_name` VARCHAR(30) NOT NULL,
  `email` VARCHAR(30) NOT NULL UNIQUE,
  `password` VARCHAR(255) NOT NULL,
  `phone_number` VARCHAR(10) NOT NULL,
  `nic` VARCHAR(12) DEFAULT NULL, -- Nullable for customers
  `birth_date` DATE DEFAULT NULL, -- Nullable for customers
  `home_town` VARCHAR(20) NOT NULL,
  `address` VARCHAR(100) NOT NULL,
  `bio` VARCHAR(255) DEFAULT NULL, -- Nullable for customers
  `category` VARCHAR(10) DEFAULT NULL, -- Nullable for customers
  `profile_pic` LONGBLOB DEFAULT NULL,
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `posts` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `description` TEXT NOT NULL,
  `image` LONGBLOB,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`user_id`) REFERENCES `users`(`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `fabrics` (
  `fabric_id` int(5) NOT NULL,
  `user_id` int(5) NOT NULL,
  `fabric_name` varchar(50) NOT NULL,
  `image` longblob DEFAULT NULL,
  `price_per_meter` decimal(10,2) NOT NULL,
  `stock` decimal(10,2) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `colors` (
  `color_id` INT(5) NOT NULL AUTO_INCREMENT,
  `color_name` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`color_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `fabric_colors` (
  `fabric_color_id` INT(5) NOT NULL AUTO_INCREMENT,
  `fabric_id` INT(5) NOT NULL,
  `color_id` INT(5) NOT NULL,
  PRIMARY KEY (`fabric_color_id`),
  FOREIGN KEY (`fabric_id`) REFERENCES `fabrics`(`fabric_id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`color_id`) REFERENCES `colors`(`color_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Insert some initial data
INSERT INTO `colors` (`color_name`) VALUES ('Black');
INSERT INTO `colors` (`color_name`) VALUES ('Red');
INSERT INTO `colors` (`color_name`) VALUES ('Blue');
INSERT INTO `colors` (`color_name`) VALUES ('Purple');
INSERT INTO `colors` (`color_name`) VALUES ('Orange');
INSERT INTO `colors` (`color_name`) VALUES ('Yellow');
INSERT INTO `colors` (`color_name`) VALUES ('Green');
INSERT INTO `colors` (`color_name`) VALUES ('White');
INSERT INTO `colors` (`color_name`) VALUES ('Gray');
INSERT INTO `colors` (`color_name`) VALUES ('Pink');